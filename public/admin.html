<!-- <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<title>Admin Dashboard</title>

<style>
body {
    font-family: Arial;
    background: #f2f2f2;
    padding: 20px;
}
h1 { margin-bottom: 20px; display:flex; justify-content:space-between; align-items:center; }
.table-box {
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 10px #0001;
    margin-bottom: 40px;
}
.controls {
    margin-bottom: 15px;
    display: flex;
    gap: 12px;
}
input, select {
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 6px;
}
table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
}
th, td {
    padding: 10px;
    border: 1px solid #ddd;
}
th {
    background: #333;
    color: white;
}
button {
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
    border: none;
}
.approve { background: #28a745; color: white; }
.reject { background: #dc3545; color: white; }
.promote { background: #007bff; color: white; }
.delete { background: #d9534f; color: white; }
.add { background: #ffc107; color: black; font-weight: bold; }
.logout { background: #dc3545; color:white; }
.pagination {
    margin-top: 10px;
    display: flex;
    gap: 10px;
}
</style>
</head>

<body>

<h1>
    Admin Dashboard
    <button class="logout" onclick="logout()">Logout</button>
</h1>

<!-- USERS SECTION -->
<!-- <div class="table-box">
    <h2>
        Users
        <button class="add" onclick="addUser()">+ Add User</button>
    </h2>

    <div class="controls">
        <input type="text" id="searchUser" placeholder="Search by name, email, phone">
        <select id="filterLevel">
            <option value="">Level Filter</option>
            <option value="1">Level 1</option>
            <option value="2">Level 2</option>
            <option value="3">Level 3</option>
            <option value="4">Level 4</option>
            <option value="5">Level 5</option>
        </select>

        <select id="filterAdmin">
            <option value="">Admin Filter</option>
            <option value="1">Admins Only</option>
            <option value="0">Users Only</option>
        </select>

        <button onclick="loadUsers()">Search</button>
    </div>

    <table id="usersTable">
        <thead>
            <tr>
                <th>ID</th><th>Name</th><th>Email</th><th>Phone</th>
                <th>Invite</th><th>Inviter</th><th>Level</th>
                <th>Balance</th><th>Admin</th><th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <div class="pagination">
        <button onclick="prevPage()">⬅️ Previous</button>
        <span id="pageLabel"></span>
        <button onclick="nextPage()">Next ➡️</button>
    </div>
</div>

<!-- TRANSACTIONS SECTION -->
<!-- <div class="table-box">
    <h2>
        Transactions  
        <button class="add" onclick="addTx()">+ Add Transaction</button>
    </h2>

    <div class="controls">
        <select id="txType">
            <option value="">All Types</option>
            <option value="recharge">Recharge</option>
            <option value="withdrawal">Withdrawal</option>
            <option value="bonus">Bonus</option>
        </select>

        <button onclick="loadTransactions()">Filter</button>
    </div>

    <table id="txTable">
  <thead>
  <tr>
    <th>ID</th>
    <th>User</th>
    <th>Type</th>
    <th>TxID / Wallet</th>
    <th>Amount</th>
    <th>Status</th>
    <th>Date</th>
    <th>Action</th>
  </tr>
</thead>

  <tbody></tbody>
</table>

</div>

<script>

const API = "https://bdgusdtmining.vip/api/admin";
const adminToken = localStorage.getItem("adminToken");
if (!adminToken) location.href = "admin_login.html"; -->

<!-- /***********************
   PAGINATION STATE
************************/
let currentPage = 1;
let limit = 10;

/***********************
       LOAD USERS
************************/
async function loadUsers() {
    const search = document.getElementById("searchUser").value;
    const level = document.getElementById("filterLevel").value;
    const admin = document.getElementById("filterAdmin").value;

    const url = `${API}/users?page=${currentPage}&limit=${limit}&search=${search}&level=${level}&admin=${admin}`;

    const res = await fetch(url, { headers: { Authorization: adminToken }});
    const data = await res.json();

    let html = "";
    data.users.forEach(u => {
        html += `
            <tr>
                <td>${u.id}</td><td>${u.user_id}</td><td>${u.name}</td><td>${u.email || "-"}</td>
                <td>${u.phone || "-"}</td><td>${u.invite_code}</td>
                <td>${u.inviter_id || "-"}</td>
                <td>${u.level}</td><td>$${u.balance}</td>
                <td>${u.is_admin ? "Yes" : "No"}</td>

                <td>
                    <button class="promote" onclick="toggleAdmin(${u.id}, ${u.is_admin})">
                        ${u.is_admin ? "Demote" : "Promote"}
                    </button>
                    <button class="delete" onclick="deleteUser(${u.id})">Delete</button>
                </td>
            </tr>`;
    }); -->

    <!-- document.querySelector("#usersTable tbody").innerHTML = html;
    document.getElementById("pageLabel").innerText = `Page ${currentPage}`;
}

function nextPage() { currentPage++; loadUsers(); }
function prevPage() { if (currentPage > 1){ currentPage--; loadUsers(); } }

/***********************
    ADD USER (POPUP)
************************/
function addUser() {
    const name = prompt("Enter name:");
    if (!name) return;

    fetch(`${API}/addUser`, {
        method: "POST",
        headers: { "Content-Type": "application/json", Authorization: adminToken },
        body: JSON.stringify({ name })
    }).then(r => r.json()).then(d => {
        alert(d.message);
        loadUsers();
    });
}

/***********************
  PROMOTE / DEMOTE USER
************************/
async function toggleAdmin(id, isAdmin) {
    const res = await fetch(`${API}/user/${id}/promote`, {
        method: "POST",
        headers: { "Content-Type": "application/json", Authorization: adminToken },
        body: JSON.stringify({ isAdmin: isAdmin ? 0 : 1 })
    });
    const data = await res.json();
    alert(data.message);
    loadUsers();
}

/***********************
        DELETE USER
************************/
async function deleteUser(id) {
    if (!confirm("Delete this user permanently?")) return;

    const res = await fetch(`${API}/user/${id}`, {
        method: "DELETE",
        headers: { Authorization: adminToken }
    });

    const data = await res.json();
    alert(data.message);
    loadUsers();
} -->

<!-- /***********************
   LOAD TRANSACTIONS
************************/

async function loadTransactions() {
  const type = document.getElementById("txType").value;

  const res = await fetch(`${API}/transactions?type=${type}`, {
    headers: { Authorization: adminToken }
  });

  const data = await res.json();
  let html = "";

  data.transactions.forEach(t => {
    let actions = "";

    if (t.status === "pending") {
      actions = `
        <button class="approve" onclick="updateTx('${t.transaction_id}', 'confirmed')">Approve</button>
        <button class="reject" onclick="updateTx('${t.transaction_id}', 'failed')">Reject</button>
      `;
    } else {
      actions = `<span>${t.status}</span>`;
    }

    html += `
      <tr>
        <td>${t.id}</td>
        <td>${t.user_id}<br><small>${t.email || ""}</small></td>
        <td>${t.type}</td>
        <td style="max-width:160px;word-break:break-all;">${t.txid || "-"}</td>
        <td>$${t.amount}</td>
        <td>${t.status}</td>
        <td>${new Date(t.created_at).toLocaleString()}</td>
        <td>${actions}</td>
      </tr>
    `;
  });

  document.querySelector("#txTable tbody").innerHTML = html;
}




    
// async function loadTransactions() {
//     const type = document.getElementById("txType").value;

//     const res = await fetch(`${API}/transactions?type=${type}`, {
//         headers: { Authorization: adminToken }
//     });

//     const data = await res.json();
//     let html = "";

//     data.transactions.forEach(t => {
//         html += `
//             <tr>
//                 <td>${t.id}</td><td>${t.user_id}</td><td>${t.type}</td>
//                 <td>$${t.amount}</td><td>${t.status}</td><td>${t.created_at}</td>
//                 <td><button class="delete" onclick="deleteTx(${t.id})">Delete</button></td>
//             </tr>
//         `;
//     });

//     document.querySelector("#txTable tbody").innerHTML = html;
// }

/***********************
    ADD TRANSACTION
************************/
function addTx() {
    const user_id = prompt("User ID?");
    const type = prompt("Type? (recharge/withdrawal/bonus)");
    const amount = prompt("Amount?");

    fetch(`${API}/transactions/add`, {
        method: "POST",
        headers: { "Content-Type": "application/json", Authorization: adminToken },
        body: JSON.stringify({ user_id, type, amount })
    }).then(r => r.json()).then(d => {
        alert(d.message);
        loadTransactions();
    });
}

/***********************
    DELETE TRANSACTION
************************/
async function deleteTx(id) {
    if (!confirm("Delete this transaction?")) return;

    const res = await fetch(`${API}/transactions/${id}`, {
        method: "DELETE",
        headers: { Authorization: adminToken }
    });

    const data = await res.json();
    alert(data.message);
    loadTransactions();
}

/***********************
        LOGOUT
************************/
function logout() {
    localStorage.removeItem("adminToken");
    location.href = "admin_login.html";
}

/* AUTOLOAD */
loadUsers();
loadTransactions();




    async function updateTx(transaction_id, status) {
  if (!confirm(`Are you sure to ${status} this transaction?`)) return;

  const res = await fetch(`${API}/transaction/confirm`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: adminToken
    },
    body: JSON.stringify({ transaction_id, status })
  });

  const data = await res.json();
  alert(data.message);
  loadTransactions();
}

</script>

</body>
</html>


 --> 

























 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<title>Admin Dashboard</title>

<style>
body {
    font-family: Arial;
    background: #f2f2f2;
    padding: 20px;
}
h1 {
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.table-box {
    background:#fff;
    padding:15px;
    border-radius:8px;
    box-shadow:0 0 10px #0001;
    margin-bottom:40px;
}
.controls {
    display:flex;
    gap:12px;
    margin-bottom:15px;
}
input, select {
    padding:8px;
    border:1px solid #ccc;
    border-radius:6px;
}
table {
    width:100%;
    border-collapse:collapse;
}
th, td {
    padding:10px;
    border:1px solid #ddd;
}
th {
    background:#333;
    color:#fff;
}
button {
    padding:6px 10px;
    border-radius:6px;
    cursor:pointer;
    border:none;
}
.add { background:#28a745; color:#fff; }
.reject { background:#dc3545; color:#fff; }
.approve { background:#007bff; color:#fff; }
.logout { background:#dc3545; color:#fff; }
.pagination {
    display:flex;
    gap:10px;
    margin-top:10px;
}
small { color:#555; }
</style>
</head>

<body>

<h1>
  Admin Dashboard
  <button class="logout" onclick="logout()">Logout</button>
</h1>

<!-- USERS -->
<div class="table-box">
<h2>Users</h2>

<div class="controls">
  <input id="searchUser" placeholder="Search name / email / phone">
  <button onclick="loadUsers()">Search</button>
</div>

<table id="usersTable">
<thead>
<tr>
  <th>ID</th>
  <th>User</th>
  <th>Balance</th>
  <th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="pagination">
  <button onclick="prevPage()">⬅ Prev</button>
  <span id="pageLabel"></span>
  <button onclick="nextPage()">Next ➡</button>
</div>
</div>

<!-- TRANSACTIONS -->
<div class="table-box">
<h2>Transactions</h2>

<div class="controls">
<select id="txType">
  <option value="">All</option>
  <option value="recharge">Recharge</option>
  <option value="withdrawal">Withdrawal</option>
</select>
<button onclick="loadTransactions()">Filter</button>
</div>

<table id="txTable">
<thead>
<tr>
  <th>ID</th>
  <th>User</th>
  <th>Type</th>
  <th>TxID / Wallet</th>
  <th>Amount</th>
  <th>Status</th>
  <th>Date</th>
  <th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
const API = "https://bdgusdtmining.vip/api/admin";
const adminToken = localStorage.getItem("adminToken");
if (!adminToken) location.href = "admin_login.html";

let page = 1, limit = 10;

/* USERS */
async function loadUsers() {
  const search = document.getElementById("searchUser").value;
  const res = await fetch(`${API}/users?page=${page}&limit=${limit}&search=${search}`, {
    headers:{Authorization:adminToken}
  });
  const data = await res.json();
  let html = "";

  data.users.forEach(u=>{
    html += `
    <tr>
      <td>${u.id}</td>
      <td>
        ${u.name}<br>
        <small>${u.email||"-"}</small><br>
        <small>${u.phone||"-"}</small>
      </td>
      <td>$${u.balance}</td>
      <td>
        <button class="add" onclick="changeBalance(${u.id},'add')">+ Add</button>
        <button class="reject" onclick="changeBalance(${u.id},'deduct')">- Deduct</button>
      </td>
    </tr>`;
  });

  document.querySelector("#usersTable tbody").innerHTML = html;
  document.getElementById("pageLabel").innerText = `Page ${page}`;
}

function nextPage(){page++;loadUsers()}
function prevPage(){if(page>1){page--;loadUsers()}}

/* BALANCE */
async function changeBalance(id, action){
  const amount = prompt(`Enter amount to ${action}`);
  if(!amount || isNaN(amount)) return alert("Invalid amount");

  const res = await fetch(`${API}/user/balance`,{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      Authorization:adminToken
    },
    body:JSON.stringify({user_id:id,action,amount})
  });

  const data = await res.json();
  alert(data.message);
  loadUsers();
}

/* TRANSACTIONS */
async function loadTransactions(){
  const type = document.getElementById("txType").value;
  const res = await fetch(`${API}/transactions?type=${type}`,{
    headers:{Authorization:adminToken}
  });
  const data = await res.json();
  let html = "";

  data.transactions.forEach(t=>{
    let info = "-";
    if(t.type==="recharge") info = t.txid || "-";
    if(t.type==="withdrawal") info = t.wallet_address || "-";

    let action = t.status==="pending"
      ? `<button class="approve" onclick="updateTx('${t.transaction_id}','confirmed')">Approve</button>
         <button class="reject" onclick="updateTx('${t.transaction_id}','failed')">Reject</button>`
      : `<b>${t.status}</b>`;

    html += `
    <tr>
      <td>${t.id}</td>
      <td>
        ${t.user_id}<br>
        <small>${t.email||""}</small><br>
        <small>${t.phone||""}</small>
      </td>
      <td>${t.type}</td>
      <td style="word-break:break-all">${info}</td>
      <td>$${t.amount}</td>
      <td>${t.status}</td>
      <td>${new Date(t.created_at).toLocaleString()}</td>
      <td>${action}</td>
    </tr>`;
  });

  document.querySelector("#txTable tbody").innerHTML = html;
}

/* TX CONFIRM */
async function updateTx(transaction_id,status){
  if(!confirm(`Confirm ${status}?`)) return;

  const res = await fetch(`${API}/transaction/confirm`,{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      Authorization:adminToken
    },
    body:JSON.stringify({transaction_id,status})
  });
  const data = await res.json();
  alert(data.message);
  loadTransactions();
}

/* LOGOUT */
function logout(){
  localStorage.removeItem("adminToken");
  location.href="admin_login.html";
}

loadUsers();
loadTransactions();
</script>

</body>
</html>
